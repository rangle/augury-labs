# Augury Labs

> Angular experimental debugging & diagnostic tools

[![CircleCI](https://circleci.com/gh/rangle/augury-labs.svg?style=svg&circle-token=3b4d4e15a644445f9bf5d449fa5746ba774bfcdf)](https://circleci.com/gh/rangle/augury-labs) [![PRs Welcome](https://img.shields.io/badge/PRs-welcome-brightgreen.svg?style=flat-square)](http://makeapullrequest.com) [![GitHub License](https://img.shields.io/badge/license-MIT-blue.svg?style=flat-square)](./LICENSE) [![Slack Status](https://augury-slack.herokuapp.com/badge.svg)](https://augury-slack.herokuapp.com) [![lerna](https://img.shields.io/badge/maintained%20with-lerna-cc00ff.svg)](https://lernajs.io/)

## About

The `augury-labs` project is a set of developer tools to help aid with [Angular](https://angular.io) development.

## Getting Started

To run your app under Augury Labs you should call the `auguryBootstrap` function exported by `@augury/core`,
passing your app module, your platform factory, the `NgZone` service, and an array of Augury Labs plugin instances that
you want to use:

```ts
auguryBootstrap({
  platform: platformBrowserDynamic,
  ngModule: AppModule,
  NgZone,
  plugins: [new PopoutZoneMonitor()]
});
```

We recommend that you use a separate `main.augury.ts` file alongside your `main.ts` file so you can choose
to under Augury Labs or not (you can even have different files and configurations for different sets of
Augury Labs plugins). For a typical `main.ts` generated by the Angular CLI the `main.augury.ts` file will
look like this:

```ts
import { enableProdMode } from '@angular/core';
import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';

import { AppModule } from './app/app.module';
import { environment } from './environments/environment';

import { NgZone } from '@angular/core';
import { auguryBootstrap } from '@augury/core';
import { PopoutZoneMonitor } from '@augury/popout-timeline';

if (environment.production) {
  enableProdMode();
}

auguryBootstrap({
  platform: platformBrowserDynamic,
  ngModule: AppModule,
  NgZone,
  plugins: [new PopoutZoneMonitor()]
});
```

Notice how the call to `auguryBootstrap` completely replaces the instatiation of
`platformBrowserDynamic` and subsequent `bootstrapModule` method call.

In order to use this alternative main file instead of the usual one you need to add
a new `augury` configuration to the `angular.json` file. Do it in two places, first as
a build configuration (look for your project under `"projects"`, then look under `"architect"`
for the `"build"` object, and look inside that for the `"configurations" object):

```json
            "augury": {
              "fileReplacements": [
                {
                  "replace": "src/main.ts",
                  "with": "src/main.augury.ts"
                }
              ]
            }
```

The second place is as a serve configuration (also under `"architect"`, but inside the `"serve"`
object, under `"configurations"`):

```json
            "augury": {
              "browserTarget": "roomy-ui:build:augury"
            }
```

After that you should be able to run `ng serve -c augury` to run a development version of your
application under Augury Labs, add that as a command (`start:augury`, for example) to your `package.json`
so you can do it more easily.

## Concepts

TODO - Describe the high level concepts of the infrastructure

## Building Plugins

TODO

## Local Development

This project is a monorepo and uses [Lerna](https://github.com/lerna/lerna) & [Yarn workspaces](https://yarnpkg.com/lang/en/docs/workspaces/) to manage multiple packages. The [tools package](./packages/tools)
also provides common dev dependencies and configurations.

### Local Setup

```sh
# Install lerna globally
npm install -g lerna

# Install dependencies
yarn install

# Build all packages
yarn build
```

### Commands

In most cases yarn commands should only be run in the root directory as lerna will take care of
running the appropriate commands on sub packages.

The following commands will run across packages:

- `yarn build`
- `yarn build:watch`
- `yarn build`
- `yarn clean`
- `yarn test`
- `yarn test:watch`
- `yarn coverage`
- `yarn lint`

### Publishing Packages

Lerna helps managing versions across packages along with publishing them. Changelogs can be generated using `yarn changelog` (using `lerna-changelog`).

TODO - Document version bump, changelong, & publishing procedure

## Contributing

We'd love to have your helping hand on augury-labs! See [CONTRIBUTING.md](./github/contributing.md) for more information on what we're looking for and how to get started.

## License

Augury Labs is open source software [licensed as MIT](./LICENSE).
